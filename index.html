<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</title>
  <meta name="description" content="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ (PWA)" />

  <!-- Styles & PWA -->
  <link rel="stylesheet" href="./styles.css" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="apple-touch-icon" href="./icon-192.png" />
  <link rel="icon" href="./icon-192.png" type="image/png" />

  <!-- Theming -->
  <meta name="theme-color" content="#764ba2" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="LogicCalc" />

  <!-- Open Graph (‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏ß‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô) -->
  <meta property="og:title" content="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">
  <meta property="og:description" content="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ô‡∏¥‡∏û‡∏à‡∏ô‡πå‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå + ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô PWA">
  <meta property="og:image" content="https://pntwut.github.io/logic-calculator2/icon-512.png">
  <meta property="og:type" content="website">
</head>
<body>
  <noscript>‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô JavaScript ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ</noscript>

  <div class="container">
    <h1>üßÆ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</h1>

    <div class="main-container">
      <div class="calculator" role="region" aria-label="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">
        <label for="display" class="sr-only">‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡∏¥‡∏û‡∏à‡∏ô‡πå‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</label>
        <input
          type="text"
          class="display"
          id="display"
          placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏π‡∏ï‡∏£‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."
          autocomplete="off"
          spellcheck="false"
          autocapitalize="off"
        />
        <div class="result-display" id="resultDisplay" aria-live="polite"></div>

        <div class="button-grid" role="group" aria-label="‡∏õ‡∏∏‡πà‡∏°‡∏ä‡πà‡∏ß‡∏¢‡∏û‡∏¥‡∏°‡∏û‡πå">
          <!-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ -->
          <button type="button" class="button btn-variable" onclick="addToDisplay('p')" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ p">p</button>
          <button type="button" class="button btn-variable" onclick="addToDisplay('q')" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ q">q</button>
          <button type="button" class="button btn-variable" onclick="addToDisplay('r')" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ r">r</button>
          <button type="button" class="button btn-variable" onclick="addToDisplay('s')" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ s">s</button>

          <!-- ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
          <button type="button" class="button btn-operator" onclick="addToDisplay('‚àß')" aria-label="AND">‚àß</button>
          <button type="button" class="button btn-operator" onclick="addToDisplay('‚à®')" aria-label="OR">‚à®</button>
          <button type="button" class="button btn-operator" onclick="addToDisplay('~')" aria-label="NOT">~</button>
          <button type="button" class="button btn-operator" onclick="addToDisplay('‚Üí')" aria-label="IMPLIES">‚Üí</button>

          <button type="button" class="button btn-operator" onclick="addToDisplay('‚Üî')" aria-label="IF AND ONLY IF">‚Üî</button>
          <button type="button" class="button btn-operator" onclick="addToDisplay('‚äï')" aria-label="XOR">‚äï</button>
          <button type="button" class="button btn-bracket"  onclick="addToDisplay('(')" aria-label="‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö‡πÄ‡∏õ‡∏¥‡∏î">(</button>
          <button type="button" class="button btn-bracket"  onclick="addToDisplay(')')" aria-label="‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö‡∏õ‡∏¥‡∏î">)</button>

          <!-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô -->
          <button type="button" class="button btn-clear"      onclick="clearDisplay()"       aria-label="‡∏•‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï">‡∏•‡πâ‡∏≤‡∏á</button>
          <button type="button" class="button btn-clear"      onclick="backspace()"          aria-label="‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤">‡∏•‡∏ö</button>
          <button type="button" class="button btn-navigation" onclick="moveCursorLeft()"     aria-label="‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Ñ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ã‡πâ‡∏≤‡∏¢">‚Üê</button>
          <button type="button" class="button btn-navigation" onclick="moveCursorRight()"    aria-label="‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Ñ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏ß‡∏≤">‚Üí</button>
          <button type="button" class="button btn-equals"     onclick="evaluateExpression()" aria-label="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì">= ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</button>
        </div>

        <button type="button" class="button btn-toggle" onclick="toggleTruthTable()">
          <span id="toggleText">‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á</span>
        </button>

        <button type="button" class="button btn-install" id="installButton" onclick="installApp()" style="display:none">
          üì± ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏û
        </button>
      </div>
    </div>

    <div class="truth-table" id="truthTable" aria-live="polite">
      <h3>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á</h3>
      <div class="table-container">
        <table id="truthTableContent">
          <thead><tr id="tableHeader"></tr></thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà -->
  <div id="updateBanner" class="update-banner" hidden>
    ‡∏û‡∏ö‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏û
    <button type="button" id="refreshBtn" class="button">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
  </div>

  <!-- ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å -->
  <script src="./script.js" defer></script>

  <!-- PWA + Update banner logic (‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ SW ‡πÉ‡∏´‡∏°‡πà‡∏£‡∏≠‡∏à‡∏£‡∏¥‡∏á) -->
  <script>
  let deferredPrompt;

  // Register SW
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', async () => {
      await navigator.serviceWorker.register('./sw.js');
    });
  }

  // PWA install button
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    const btn = document.getElementById('installButton');
    if (btn) btn.style.display = 'block';
  });
  function installApp() {
    if (!deferredPrompt) {
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå');
      return;
    }
    deferredPrompt.prompt();
    deferredPrompt.userChoice.finally(() => (deferredPrompt = null));
  }
  window.addEventListener('appinstalled', () => {
    const btn = document.getElementById('installButton');
    if (btn) btn.style.display = 'none';
  });

  // ===== Update banner: show only when reg.waiting exists =====
  const banner = document.getElementById('updateBanner');
  const refreshBtn = document.getElementById('refreshBtn');

  function showBanner() { if (banner && banner.hidden) banner.hidden = false; }
  function hideBanner() { if (banner && !banner.hidden) banner.hidden = true; }

  // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ SW ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏Ñ‡∏∏‡∏°‡∏´‡∏ô‡πâ‡∏≤ ‚Üí ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.addEventListener('controllerchange', () => {
      hideBanner();
      setTimeout(() => location.reload(), 50);
    });

    window.addEventListener('load', async () => {
      const reg = await navigator.serviceWorker.getRegistration();
      if (!reg) return;

      // ‡∏°‡∏µ SW ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏£‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á ‚Üí ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÇ‡∏ú‡∏•‡πà
      if (reg.waiting) showBanner();

      // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡∏≠‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
      reg.addEventListener('updatefound', () => {
        const newSW = reg.installing;
        if (!newSW) return;
        newSW.addEventListener('statechange', () => {
          if (newSW.state === 'installed' && navigator.serviceWorker.controller) {
            showBanner();
          }
        });
      });

      // ‡∏õ‡∏∏‡πà‡∏° "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ"
      if (refreshBtn) {
        refreshBtn.onclick = async () => {
          const latest = await navigator.serviceWorker.getRegistration();
          if (!latest) return;

          // ‡∏°‡∏µ waiting ‡∏à‡∏£‡∏¥‡∏á ‚Üí ‡∏™‡∏±‡πà‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏Ñ‡∏¥‡∏ß
          if (latest.waiting) {
            latest.waiting.postMessage({ type: 'SKIP_WAITING' });
            return;
          }

          // ‡πÑ‡∏°‡πà‡∏°‡∏µ waiting (‡πÄ‡∏ä‡πà‡∏ô active ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß) ‚Üí ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏â‡∏¢ ‡πÜ
          location.reload();
        };
      }
    });
  }
  </script>
</body>
</html>
