<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</title>
  <meta name="description" content="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ (PWA)" />

  <!-- Styles & PWA -->
  <link rel="stylesheet" href="./styles.css" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="apple-touch-icon" href="./icon-192.png" />
  <meta name="theme-color" content="#764ba2" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="LogicCalc" />
</head>
<body>
  <noscript>‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô JavaScript ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ</noscript>

  <div class="container">
    <h1>üßÆ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</h1>

    <div class="main-container">
      <div class="calculator" role="region" aria-label="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">
        <label for="display" class="sr-only">‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡∏¥‡∏û‡∏à‡∏ô‡πå‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</label>
        <input
          type="text"
          class="display"
          id="display"
          placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏π‡∏ï‡∏£‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."
          autocomplete="off"
          spellcheck="false"
          autocapitalize="off"
        />
        <div class="result-display" id="resultDisplay" aria-live="polite"></div>

        <div class="button-grid" role="group" aria-label="‡∏õ‡∏∏‡πà‡∏°‡∏ä‡πà‡∏ß‡∏¢‡∏û‡∏¥‡∏°‡∏û‡πå">
          <!-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ -->
          <button type="button" class="button btn-variable" onclick="addToDisplay('p')" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ p">p</button>
          <button type="button" class="button btn-variable" onclick="addToDisplay('q')" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ q">q</button>
          <button type="button" class="button btn-variable" onclick="addToDisplay('r')" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ r">r</button>
          <button type="button" class="button btn-variable" onclick="addToDisplay('s')" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ s">s</button>

          <!-- ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
          <button type="button" class="button btn-operator" onclick="addToDisplay('‚àß')" aria-label="AND">‚àß</button>
          <button type="button" class="button btn-operator" onclick="addToDisplay('‚à®')" aria-label="OR">‚à®</button>
          <button type="button" class="button btn-operator" onclick="addToDisplay('~')" aria-label="NOT">~</button>
          <button type="button" class="button btn-operator" onclick="addToDisplay('‚Üí')" aria-label="IMPLIES">‚Üí</button>

          <button type="button" class="button btn-operator" onclick="addToDisplay('‚Üî')" aria-label="IF AND ONLY IF">‚Üî</button>
          <button type="button" class="button btn-operator" onclick="addToDisplay('‚äï')" aria-label="XOR">‚äï</button>
          <button type="button" class="button btn-bracket"  onclick="addToDisplay('(')" aria-label="‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö‡πÄ‡∏õ‡∏¥‡∏î">(</button>
          <button type="button" class="button btn-bracket"  onclick="addToDisplay(')')" aria-label="‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö‡∏õ‡∏¥‡∏î">)</button>

          <!-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô -->
          <button type="button" class="button btn-clear"      onclick="clearDisplay()"       aria-label="‡∏•‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï">‡∏•‡πâ‡∏≤‡∏á</button>
          <button type="button" class="button btn-clear"      onclick="backspace()"          aria-label="‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤">‡∏•‡∏ö</button>
          <button type="button" class="button btn-navigation" onclick="moveCursorLeft()"     aria-label="‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Ñ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ã‡πâ‡∏≤‡∏¢">‚Üê</button>
          <button type="button" class="button btn-navigation" onclick="moveCursorRight()"    aria-label="‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Ñ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏ß‡∏≤">‚Üí</button>
          <button type="button" class="button btn-equals"     onclick="evaluateExpression()" aria-label="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì">= ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</button>
        </div>

        <button type="button" class="button btn-toggle" onclick="toggleTruthTable()">
          <span id="toggleText">‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á</span>
        </button>

        <button type="button" class="button btn-install" id="installButton" onclick="installApp()" style="display:none">
          üì± ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏û
        </button>
      </div>
    </div>

    <div class="truth-table" id="truthTable" aria-live="polite">
      <h3>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á</h3>
      <div class="table-container">
        <table id="truthTableContent">
          <thead><tr id="tableHeader"></tr></thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà -->
  <div id="updateBanner" class="update-banner" hidden>
    ‡∏û‡∏ö‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏û
    <button type="button" id="refreshBtn" class="button">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
  </div>

  <!-- ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å -->
  <script src="./script.js" defer></script>

  <!-- PWA + Update banner logic -->
  <script>
    let deferredPrompt;

    // ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js');
      });
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏û (PWA)
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      const installButton = document.getElementById('installButton');
      installButton.style.display = 'block';
    });

    function installApp() {
      if (!deferredPrompt) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå');
        return;
      }
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then((choice) => {
        if (choice.outcome === 'accepted') {
          document.getElementById('installButton').style.display = 'none';
        }
        deferredPrompt = null;
      });
    }

    window.addEventListener('appinstalled', () => {
      const btn = document.getElementById('installButton');
      if (btn) btn.style.display = 'none';
    });

    // ===== ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà + ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï =====
    if ('serviceWorker' in navigator) {
      // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ SW ‡πÉ‡∏´‡∏°‡πà activate ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏∏‡∏°‡∏´‡∏ô‡πâ‡∏≤ ‚Üí ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå & ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        const banner = document.getElementById('updateBanner');
        if (banner) banner.hidden = true;
        window.location.reload();
      });

      window.addEventListener('load', async () => {
        const reg = await navigator.serviceWorker.getRegistration();
        if (!reg) return;

        const banner = document.getElementById('updateBanner');
        const btn = document.getElementById('refreshBtn');

        const showBanner = () => { if (banner && banner.hidden) banner.hidden = false; };

        // ‡∏°‡∏µ SW ‡πÉ‡∏´‡∏°‡πà‡∏£‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡πÇ‡∏ä‡∏ß‡πå‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå
        if (reg.waiting) showBanner();

        // ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ‚Üí ‡∏£‡∏≠‡∏à‡∏ô installed ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÇ‡∏ä‡∏ß‡πå
        reg.addEventListener('updatefound', () => {
          const newSW = reg.installing;
          if (!newSW) return;
          newSW.addEventListener('statechange', () => {
            if (newSW.state === 'installed' && navigator.serviceWorker.controller) {
              showBanner();
            }
          });
        });

        // ‡∏õ‡∏∏‡πà‡∏° "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ"
        if (btn) {
          btn.addEventListener('click', async () => {
            const latestReg = await navigator.serviceWorker.getRegistration();
            if (!latestReg) return;

            // 1) ‡∏°‡∏µ waiting ‚Üí ‡∏Ç‡πâ‡∏≤‡∏° waiting ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (SW ‡∏à‡∏∞ activate ‡πÅ‡∏•‡πâ‡∏ß controllerchange ‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÄ‡∏≠‡∏á)
            if (latestReg.waiting) {
              latestReg.waiting.postMessage({ type: 'SKIP_WAITING' });
              return;
            }

            // 2) ‡∏Å‡∏≥‡∏•‡∏±‡∏á installing ‚Üí ‡∏£‡∏≠‡πÉ‡∏´‡πâ installed ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏™‡∏±‡πà‡∏á
            if (latestReg.installing) {
              const sw = latestReg.installing;
              sw.addEventListener('statechange', () => {
                if (sw.state === 'installed' && latestReg.waiting) {
                  latestReg.waiting.postMessage({ type: 'SKIP_WAITING' });
                }
              });
              return;
            }

            // 3) ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà ‚Üí ‡∏Ç‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà
            await latestReg.update();
          });
        }
      });
    }
  </script>
</body>
</html>
