<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</title>
    <link rel="stylesheet" href="./styles.css" />
    <link rel="manifest" href="./manifest.json" />
    <meta name="theme-color" content="#764ba2" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="LogicCalc" />
</head>
<body>
    <div class="container">
        <h1>üßÆ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</h1>

        <div class="main-container">
            <div class="calculator">
                <input type="text" class="display" id="display" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏π‡∏ï‡∏£‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." />
                <div class="result-display" id="resultDisplay"></div>

                <div class="button-grid">
                    <!-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ -->
                    <button class="button btn-variable" onclick="addToDisplay('p')">p</button>
                    <button class="button btn-variable" onclick="addToDisplay('q')">q</button>
                    <button class="button btn-variable" onclick="addToDisplay('r')">r</button>
                    <button class="button btn-variable" onclick="addToDisplay('s')">s</button>

                    <!-- ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
                    <button class="button btn-operator" onclick="addToDisplay('‚àß')" title="AND">‚àß</button>
                    <button class="button btn-operator" onclick="addToDisplay('‚à®')" title="OR">‚à®</button>
                    <button class="button btn-operator" onclick="addToDisplay('~')" title="NOT">~</button>
                    <button class="button btn-operator" onclick="addToDisplay('‚Üí')" title="IMPLIES">‚Üí</button>

                    <button class="button btn-operator" onclick="addToDisplay('‚Üî')" title="IFF">‚Üî</button>
                    <button class="button btn-operator" onclick="addToDisplay('‚äï')" title="XOR">‚äï</button>
                    <button class="button btn-bracket" onclick="addToDisplay('(')">(</button>
                    <button class="button btn-bracket" onclick="addToDisplay(')')">)</button>

                    <!-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô -->
                    <button class="button btn-clear" onclick="clearDisplay()">‡∏•‡πâ‡∏≤‡∏á</button>
                    <button class="button btn-clear" onclick="backspace()">‡∏•‡∏ö</button>
                    <button class="button btn-navigation" onclick="moveCursorLeft()">‚Üê</button>
                    <button class="button btn-navigation" onclick="moveCursorRight()">‚Üí</button>
                    <button class="button btn-equals" onclick="evaluateExpression()">= ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</button>
                </div>

                <button class="button btn-toggle" onclick="toggleTruthTable()">
                    <span id="toggleText">‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á</span>
                </button>

                <button class="button btn-install" id="installButton" onclick="installApp()" style="display: none;">
                    üì± ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏û
                </button>
            </div>
        </div>

        <div class="truth-table" id="truthTable">
            <h3>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á</h3>
            <div class="table-container">
                <table id="truthTableContent">
                    <thead><tr id="tableHeader"></tr></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà -->
    <div id="updateBanner" class="update-banner" hidden>
      ‡∏û‡∏ö‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏û
      <button id="refreshBtn" class="button">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
    </div>

    <!-- ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏ö‡∏ö defer ‡πÉ‡∏´‡πâ DOM ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô -->
    <script src="./script.js" defer></script>

    <script>
    let deferredPrompt;

    // Service Worker: register
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('./sw.js'); // ‡πÉ‡∏ä‡πâ‡∏û‡∏≤‡∏ò‡πÅ‡∏ö‡∏ö relative
      });
    }

    // PWA Install Handler
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á
      const installButton = document.getElementById('installButton');
      installButton.style.display = 'block';
    });

    function installApp() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('User accepted the install prompt');
            document.getElementById('installButton').style.display = 'none';
          } else {
            console.log('User dismissed the install prompt');
          }
          deferredPrompt = null;
        });
      } else {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå');
      }
    }

    window.addEventListener('appinstalled', () => {
      document.getElementById('installButton').style.display = 'none';
    });

    // ====== ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô "‡∏°‡∏µ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà" + ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ======
    if ('serviceWorker' in navigator) {
      // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ SW ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏Ñ‡∏∏‡∏°‡∏´‡∏ô‡πâ‡∏≤ ‚Üí ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        window.location.reload();
      });

      window.addEventListener('load', async () => {
        const reg = await navigator.serviceWorker.getRegistration();
        if (!reg) return;

        const banner = document.getElementById('updateBanner');
        const btn = document.getElementById('refreshBtn');

        function showBanner() {
          if (banner) banner.hidden = false;
        }

        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏£‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
        if (reg.waiting) showBanner();

        // ‡∏à‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ SW ‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ‚Üí ‡∏£‡∏≠‡∏à‡∏ô installed ‡πÅ‡∏•‡πâ‡∏ß‡πÇ‡∏ä‡∏ß‡πå‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå
        reg.addEventListener('updatefound', () => {
          const newWorker = reg.installing;
          if (!newWorker) return;
          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
              showBanner();
            }
          });
        });

        // ‡∏õ‡∏∏‡πà‡∏° "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ" ‚Üí ‡∏™‡∏±‡πà‡∏á SW ‡πÉ‡∏´‡∏°‡πà‡∏Ç‡πâ‡∏≤‡∏° waiting
        if (btn) {
          btn.addEventListener('click', () => {
            if (reg.waiting) {
              reg.waiting.postMessage({ type: 'SKIP_WAITING' });
            } else {
              reg.update(); // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ waiting
            }
          });
        }
      });
    }
    </script>
</body>
</html>
